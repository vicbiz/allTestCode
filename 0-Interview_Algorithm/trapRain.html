<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
        const data = [2,0,2];
        // const data = [0,1,0,2,1,0,1,3,2,1,2,1];
        // const data = [0,3,2,1,2,3,0,2,1,2,1,0];
        // const data = [0,1,0,3,2,1,0,1,1,2,4,3,1,0,2,1,0,2,0];


        let trappedGrandTotal = 0;
        let currentIdx = data.findIndex( it => it > 0 );
        let lastIdx = data.length-1;
        let notFoundNextIndex = false;

        let findNextIdx = function(nIdx, cVal){
            return data.findIndex( (it, idx) => {
                if(idx > nIdx && it >= cVal ) return true;
            });    
        }

        do {
            let currentVal = data[currentIdx];
            let nextIdx = currentIdx;
            
            nextIdx = findNextIdx(nextIdx, currentVal);
            // console.log("currentIdx : ", currentIdx, "lastIdx : ", lastIdx, "nextIdx ", nextIdx);
            
            if(nextIdx > 0){

                let segTotalSpace = 0;
                let segBlockTotal = 0;

                if(notFoundNextIndex){
                    segTotalSpace = Math.max(currentVal, data[nextIdx]) * (nextIdx - currentIdx);
                    // console.log("max : ", Math.max(currentVal, data[nextIdx]), "nextIdx : ", nextIdx, "currentIdx ", currentIdx);
                    segBlockTotal = data.reduce( (total, currentValue, i) => {
                        if(i >= currentIdx && i < nextIdx){
                            return total + currentValue;
                        } else return total;
                    })
                } else {
                    segTotalSpace = Math.min(currentVal, data[nextIdx]) * (nextIdx - currentIdx - 1);
                    segBlockTotal = data.reduce( (total, currentValue, i) => {
                        if(i > currentIdx && i < nextIdx){
                            return total + currentValue;
                        } else return total;
                    })
                }


                trappedSagTotal = segTotalSpace - segBlockTotal;
                trappedGrandTotal += trappedSagTotal;

                // console.log("segTotalSpace",segTotalSpace, "segTotal",segBlockTotal, "trappedSagTotal",trappedSagTotal, "trappedGrandTotal",trappedGrandTotal);
                // console.log('-----------------------------------------------------------');
            
                currentIdx = nextIdx;
            
            } else if(nextIdx == -1 && currentIdx < lastIdx){
                currentIdx ++;
                notFoundNextIndex = true;
            }
            else {
                currentIdx = lastIdx;
            }
        } while ( currentIdx < lastIdx)

        console.log("\n******************************************");
        console.log("data :", data);
        console.log("Final Trapped Rain Water Total : ", trappedGrandTotal);
        console.log("****************************************** \n");

    </script>
</head>
<body>
    
</body>
</html>