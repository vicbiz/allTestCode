$().ready(function(){$('[data-toggle="checkbox"]').each(function(){$(this).checkbox()});var n=function(){0<$(".filePanelWrap form input.save:enabled").length?$("#saveAll").removeAttr("disabled"):$("#saveAll").attr("disabled","disabled")},l=function(){0<$(".filePanelWrap form input.save:enabled").length?$("#saveAll").val("Saving ....").removeAttr("disabled"):$("#saveAll").val("Save All").attr("disabled","disabled")};$("#saveAll").on("click",function(e){e.preventDefault(),$(".filePanelWrap form input.save:enabled").each(function(){$(this).trigger("click")})}),$(".filePanelWrap .cancel").on("click",function(e){if(e.preventDefault(),1==confirm("Are you sure you want to discard this change?")){$(this).closest("form")[0].reset();var t=$(this).closest("form").find("select"),a=$(t).parent().attr("data-section");$(this).closest("form").find("select option[value='"+a+"']").prop("selected",!0),$(this).closest("form").find("select").selectpicker("render"),$(this).closest("form").find("input.save, input.cancel").attr("disabled","disabled")}n()}),$(".uploaderFormBlock form input#description").keyup(function(){$(this).removeClass("error")}),$(".filePanelWrap .save").on("click",function(e){if(e.preventDefault(),""===$(this).closest("form").find("#description").val())return $(this).closest("form").find("#description").focus().addClass("error"),!1;var i=$(this),t="/evaluationFile/updateEvaluationImage/";0<$(".uploaderFormBlock.attachment").length&&(t="/evaluationFile/updateEvaluationAttachment/"),$(i).attr("value","Saving"),l(),$.ajax({type:"POST",url:t,data:$(this).closest("form").serialize(),success:function(e,t,a,n){setTimeout(function(){$(i).attr("value","Save"),$(i).attr("disabled","disabled"),$(i).parent().find("input.cancel").attr("disabled","disabled"),l()},1e3)}})}),$(".filePanelWrap .xBtnWrap").on("click",function(e){e.preventDefault();var i=$(this),t="Are you sure you want to delete this photo?",a="/evaluationFile/deleteEvaluationImage/";if(0<$(".uploaderFormBlock.attachment").length&&(t="Are you sure you want to delete this attachment?",a="/evaluationFile/deleteEvaluationAttachment/"),1!=confirm(t))return!1;$.ajax({type:"POST",url:a,data:$(this).closest("form").serialize(),success:function(e,t,a,n){$(i).closest(".filePanelWrap").remove()}})}),0<$(".attachDownloadLink").length&&$(".attachDownloadLink a").autoShorten(33),$(window).bind("beforeunload",function(){var e=$("input.save").length;if($("input.save[disabled]").length<e)return"You have not saved the content you entered on this page."});var t=function(e){e.closest("form").data("changed",!0),e.closest("form").find("input").removeAttr("disabled"),n()};$("form :input").change(function(){var e=$(this);t(e)}),$("form textarea").keyup(function(){var e=$(this);t(e)}),$("form input").keyup(function(){var e=$(this);t(e)})});