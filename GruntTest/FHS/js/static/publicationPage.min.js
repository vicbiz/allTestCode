$(document).ready(function(){if(0<$("#publishingToolPage").length){var i=$("#publishableTable").dataTable({sPaginationType:"full_numbers",iDisplayLength:100,aLengthMenu:[[50,100,500,1e3,-1],[50,100,500,1e3,"All"]],aoColumnDefs:[{bSortable:!1,aTargets:[0,-2]}],aaSorting:[[2,"asc"],[1,"asc"]]}),b=$("#inProgressTable").dataTable({sPaginationType:"full_numbers",iDisplayLength:100,aLengthMenu:[[50,100,500,1e3,-1],[50,100,500,1e3,"All"]]}),v=$("#notifiableTable").dataTable({sPaginationType:"full_numbers",iDisplayLength:100,aLengthMenu:[[50,100,500,1e3,-1],[50,100,500,1e3,"All"]],aoColumnDefs:[{bSortable:!1,aTargets:[0]}],aaSorting:[[7,"desc"]]}),e=function(e,t,n){t?e.fnFilter(t,n):(e.fnFilter("",n),e.fnFilter(""))};$("#displayDate").on("change",function(){e(i,$("#displayDate").val(),5)}),$("#assetType").on("change",function(){e(i,$("#assetType").val(),4)}),$("#region").on("change",function(){e(i,$("#region").val(),3)}),$("#ratingYear").on("change",function(){e(i,$("#ratingYear").val(),6)}),e(i,$("#displayDate").val(),5),e(i,$("#assetType").val(),4),e(i,$("#region").val(),3),e(i,$("#ratingYear").val(),6),$("#displayDateNotify").on("change",function(){console.log("changed"),e(v,$("#displayDateNotify").val(),5)}),$("#assetTypeNotify").on("change",function(){e(v,$("#assetTypeNotify").val(),4)}),$("#regionNotify").on("change",function(){e(v,$("#regionNotify").val(),3)}),e(v,$("#displayDateNotify").val(),5),e(v,$("#assetTypeNotify").val(),4),e(v,$("#regionNotify").val(),3);var y=function(e,t){for(var n=[],a=e.fnGetNodes(),i=0;i<a.length;i++){var o=$(a[i]).find("td:nth-child(4)").text();""!==$.trim(o)&&-1===$.inArray(o,n)&&n.push(o)}var l='<option value="" selected="selected">All</option>';$.each(n,function(e){l+='<option value="'+n[e]+'">'+n[e]+"</option>"}),t.html(""),t.append(l)};y(i,$("#region")),y(v,$("#regionNotify"));var k=function(e,t){0===t.fnGetData().length?(e.attr("disabled",!0),e.parent().find("label").addClass("disabledLabel"),e.parentsUntil("form").find("input:submit").attr("disabled",!0)):(e.removeAttr("disabled"),e.parent().find("label").removeClass("disabledLabel"),e.parentsUntil("form").find("input:submit").removeAttr("disabled"));for(var n=e.prop("checked"),a=t.fnGetNodes(),i=0;i<a.length;i++)$(a[i]).find("input:checkbox").prop("checked",n)};$("#checkAll").on("change",function(){k($(this),i)}),$("#checkAllNotifiable").on("change",function(){k($(this),v)}),$("#checkAll,#checkAllNotifiable").prop("checked",!1),k($("#checkAll"),i),k($("#checkAllNotifiable"),v),$("#publishableTable td input:checkbox").on("click",function(){for(var e=i.fnGetData().length,t=0,n=i.fnGetNodes(),a=0;a<n.length;a++){$(n[a]).find("input:checkbox").prop("checked")&&++t}t===e?$("#checkAll").prop("checked","checked"):$("#checkAll").prop("checked","")}),$("#notifiableTable td input:checkbox").on("click",function(){for(var e=v.fnGetData().length,t=0,n=v.fnGetNodes(),a=0;a<n.length;a++){$(n[a]).find("input:checkbox").prop("checked")&&++t}t===e?$("#checkAllNotifiable").prop("checked","checked"):$("#checkAllNotifiable").prop("checked","")});var T=b.fnSettings().fnRecordsTotal(),m=[],t=null,n=function(){0===$("#inProgressTable tbody tr td.dataTables_empty").length&&$.ajax({type:"GET",url:"/publication/checkProgress",success:function(e){!function(e){for(var t=[],n=b.fnGetNodes(),a=0;a<=n.length;a++)$(n[a]).attr("id")&&t.push($(n[a]).attr("id"));for(a=0;a<e.length;a++){var i="eval"+e[a];0<=$.inArray(i,t)&&($.inArray(i,t),t.splice($.inArray(i,t),1))}for(a=0;a<t.length;a++)for(var o=0;o<n.length;o++)if(t[a]===$(n[o]).attr("id"))if(0<=$.inArray(t[a],m));else{var l=$(n[o]);l.addClass("processed"),l.fadeOut(2e3,function(){var e=b.fnGetPosition($(this).get(0));$(this).remove(),b.fnDeleteRow(e,function(){var e=b.fnSettings().fnRecordsTotal();$("#processing_info_total").html(e),$("#processed_info_total").html(T-e)})}),m.push(t[a]);var s=t[a].replace("eval",""),r=[],c="";r.push('<input type="hidden" name="_idsToNotify"><input id="idsToNotify" type="checkbox" value="'+s+'" name="idsToNotify">'),$(n[o]).find("td").each(function(e){r.push($(this).text()),c+=0<e?$(this).text()+" ":$(this).text()+"<br/>"});var f=new Date,d=$.datepicker.formatDate("mm/dd/yy",f),p=f.getHours(),h=f.getMinutes();12<f.getHours()&&(p=parseInt(f.getHours())-12),parseInt(p)<10&&(p=" 0"+p),parseInt(h)<10&&(h=" 0"+h),d+=p+":"+h+":AM",c='<div id="processMsg'+s+'" class="processMsgBox">Finished processing: <br/>'+c+" evaluation. </div>",r.push(d);var u=v.fnAddData(r),g=v.fnSettings().aoData[u[0]].nTr;$(g).addClass("newAddedRow",function(){0<$(".processMsgBox").length&&$(".processMsgBox").slideUp("fast"),$("body").prepend(c);var e="#processMsg"+s;$(e).slideDown("slow"),setTimeout(function(){$(e).slideUp("fast",function(){$(e).remove()})},2e3)}),y(v,$("#regionNotify")),k($("#checkAllNotifiable"),v)}}(e),0===b.fnGetNodes().length&&clearInterval(t)}})};t=setInterval(function(){n()},2e4),n()}});