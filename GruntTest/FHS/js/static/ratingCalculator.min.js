$(document).ready(function(){if("true"===$("#calculatorMenu").attr("data-isReport"))var t={sPaginationType:"full_numbers",aoColumns:[null,null,null,null,{sType:"date"},{sType:"percent"},{sType:"percent"},{sType:"percent"},{sType:"percent"},null,null,null,{sType:"percent"},null,{bSortable:!1},null,null,null,null,{sType:"percent"},{bSortable:!1},null,null,null,null,null,null],aaSorting:[[1,"desc"],[0,"asc"]],iDisplayLength:100};else t={sPaginationType:"full_numbers",aoColumns:[null,null,null,null,{sType:"date"},{sType:"percent"},{sType:"percent"},{sType:"percent"},{sType:"percent"},null,null,{bSortable:!1},{sType:"percent"},null,{bSortable:!1},null,null,null,null,{sType:"percent"},{bSortable:!1},null,null,null,null,null,null],aaSorting:[[1,"desc"],[0,"asc"]],iDisplayLength:100};var d=$("#data").dataTable(t),e=function(){var t=$("#published").prop("checked"),e=$("#notPublished").prop("checked"),a=$("#canceled").prop("checked"),n=[];if(t&&n.push("Published"),e&&n.push("Approved"),a&&n.push("Canceled"),0==n.length)d.fnFilter("*****NO*SELECTION*****",17);else{var l=n.join("|");d.fnFilter(l,17,!0)}};$("#published, #notPublished, #canceled").on("change",function(){e()}),e();var a=function(){var t=$("#filterByregion").val().replace("&","").trim();if(""===t)d.fnFilter("",23),d.fnFilter("",24);else{var e=t.split("|");-1<t.indexOf("|")?"The Americas|USA -"===t?(d.fnFilter("",23),d.fnFilter(e[1],24)):(d.fnFilter("",23),d.fnFilter("^"+e[1]+"$",24,!0,!1)):(d.fnFilter("^"+e[0]+"$",23,!0,!1),d.fnFilter("",24))}};$("#filterByregion").on("change",function(){a()}),a();var n=function(){$("#noteOnly").prop("checked")?d.fnFilter("true",26):d.fnFilter("",26)};$("#noteOnly").on("change",function(){n()}),n(),$("#displayDate").on("change",function(){var t=this.value;t?d.fnFilter(t,1):(d.fnFilter("",1),d.fnFilter(""))});var l=function(t,e,a){var n=$(t).closest("tr").get(0),l=$(e).index();$(e).index(a),d.fnUpdate(a,n,l)};$(document).on("change",".assignFianlRatingDropdown",function(){var t,a,n,e=$(this).attr("data-evalId");t=e,a=this,n=$(a).val(),$.ajax({type:"POST",url:"/rating/assign/"+t+"?ratingStatus="+n,success:function(t){if("false"===t)fhsAlert("myModal","Error","<p>Error. This asset already has an assigned rating for this standards year. To change the rating, please un-select the other assigned rating in this table.</p>","","OK",function(t){}),$(a).val(null);else if("error"===t)fhsAlert("myModal","System Error","<p>An error has occurred while trying to assign a rating. Please contact support.</p>","","OK",function(t){});else{var e=$(a).attr("data-idx");l(a,"#final-rating-data-"+e,t),l(a,"#ratingStausText-"+e,n)}}})}),$(document).on("change","#downloadReport #filter",function(){var t=$(this).val(),e=$(this).attr("data-selectedYear"),a=$(this).attr("data-assetType");window.location.href="/download/ratingsCalculatorSpreadsheet?id="+e+"&assetType="+a+"&filter="+t}),$(document).on("change","#filterByPartnerStatus",function(){updateFilter(d,"#filterByPartnerStatus",22)}),updateFilter(d,"#filterByPartnerStatus",22);var r=function(){var t=$("#filterByFinalRatingStatus").val();""===t?d.fnFilter("",21):d.fnFilter("^"+t+"$",21,!0,!1)};$(document).on("change","#filterByFinalRatingStatus",function(){r()}),r();var i=function(){var t=$("#filterByPreviousRating").val();"changed"===t?d.fnFilter(t,18,!0,!1):(d.fnFilter("",18,!0,!1),""===t?d.fnFilter("",16):"^$"===t?d.fnFilter(t,16,!0,!1):d.fnFilter(t,16))};$(document).on("change","#filterByPreviousRating",function(){i()}),i(),$(document).on("change",".provisionalScoreSelect",function(){var t=$(this).val(),a=$(this).attr("data-idx"),e=$(this).attr("data-evalId"),n=$("#assignFianlRating-"+a).val();$.ajax({type:"POST",data:"provisional="+t,url:"/rating/editProvisional/"+e+"?ratingStatus="+n,success:function(t,e){$("#final-composite-data-"+a).html(t.score),n&&$("#final-rating-data-"+a).html(t.rating),jQuery("#system-rating-data-"+a).html(t.systemRating)},error:function(t,e,a){}});t=$(this).val();$(this).parent().find(".provisionalScore").text(t),$(this).find("option").removeAttr("selected"),$(this).find("option[value='"+t+"']").attr("selected","selected").prop("selected",!0);var l=$(this).closest("tr").get(0),r=$(this).parent().html();d.fnUpdate(r,l,1)}),$(document).on("click",".evalNoteIcon",function(t){var e=$(this).hasClass("viewOnly");if(e&&$(this).hasClass("fui-bubble"))return!1;t.preventDefault();var c=$(this),a=$(this).parent().find(".evalNoteText").text(),n="/rating/modifyRatingNotes/"+$(this).attr("data-evalId"),l="",r=c.parents("tr").find(".evalTitle a").text(),i="CANCEL",s="SAVE",o="";if(""!==a&&(l='<a class="btn btn-primary etcBtn" data-return="delete" data-dismiss="modal" href="#">Delete Note</a>'),0<$("#evalReportPage").length||e){i="",s="CLOSE";l="",o="disabled"}var u='Note for <span class="evalTitle">'+r+'</span><br/><br/><form id="evalNote" action="'+n+'"><textarea id="ratingNotes" '+o+' class="form-control" rows="5" cols="140" placeholder="" name="ratingNotes" >'+a+"</textarea></form>"+l;t.stopImmediatePropagation(),fhsAlert("evalNoteModal","Rating Calculator Notes",u,i,s,function(u){if(!1===u)return!1;"delete"===u&&$("#evalNote #ratingNotes").val(null),$.ajax({type:"POST",url:n,data:$("#evalNote").serialize(),success:function(t,e,a,n){var l=$("#evalNote #ratingNotes").val(),r=function(t,e){""===t?(e.removeClass("fui-chat").addClass("fui-bubble"),e.parent().removeClass("tdToolTipData"),e.parent().find(".evalNoteText").text("").removeClass("tdToolTipDataText"),e.parent().parent().find(".hasNote").text("")):(e.removeClass("fui-bubble").addClass("fui-chat"),e.parent().addClass("tdToolTipData"),e.parent().find(".evalNoteText").text(l).addClass("tdToolTipDataText"),e.parent().parent().find(".hasNote").text("true"))},i="";"delete"===u||""===l?r(i,c):!0===u&&r(i="true",c);var s=c.closest("tr").get(0),o=c.parent().html();d.fnUpdate(o,s,20),d.fnUpdate(i,s,26),d.fnDraw()},error:function(t,e,a){}})})})});