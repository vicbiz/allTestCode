$().ready(function(){if(0<$("#cpAssetTable").length){var s=function(){return 10-$("#selectedTable").find("div").length},c=function(e){s();var a,t=$("#selectedTable .selectedPropName").length,o="<span class='sError'>Minimum is not met.</span>";6<t&&(o=""),$("#slotAvailMsg").html("You have selected: "+t+" (Minimum 7, Maximum 10) "+o),a=s(),$("#selectedBucket td").each(function(){var e=$(this).find(".selectedPropName").length,t="&nbsp;";2<e?t="<span class='sGood'>&nbsp;</span>":(0<e&&(t="<span class='sError'>Please select at least (3) properties at this rating level.</span>"),a<3-e&&0<e&&(t="<span class='sError'>Sorry, not enough slots for this selection. <a href='' id='cDetail'>DETAILS</a></span>")),$("#"+$(this).attr("id")+"Msg").html(t)}),6<t&&0===$("#selectedTable .sError").length?(10===t&&$("#selectedTable .selMsg").each(function(){$(this).html("<span class='sGood'>No more slots available.</span>")}),$("#btnGroup #cpSubmit").removeClass("disabled")):$("#btnGroup #cpSubmit").removeClass("disabled").addClass("disabled"),n()},i=function(e){return"Five Star"===e?"5":"Four Star"===e?"4":"Recommended"===e?"R":void 0},t=function(e){var t=i(e.attr("data-rating")),a=e.attr("data-ratingId");if(0<$("#selectedTable #pId"+a).length)$("#selectedTable #pId"+a).remove();else{var o='<div id="pId'+a+'" class="selectedPropName" data-rating="'+t+'" data-pId="'+a+'"><span class="removeX">X</span>'+e.parent().parent().find("td.pName").text()+"</div>";$("#selectedTable #selection"+t).append(o)}c()},a=function(e){var t,a,u,o;if($("#sectedBucketBlock form input:hidden[name=displayName]").val($("#cpDisplayName").val().trim()),$("#sectedBucketBlock form input:hidden[name=allowClientView]").val($("#cpAllowClientView").prop("checked")),$("#sectedBucketBlock form input:hidden[name=cpSelected]").val((t="",a=$("#selectedBucket .selectedPropName").length,$("#selectedBucket .selectedPropName").each(function(e){t+=$(this).attr("data-pId"),e<a-1&&(t+=",")}),t)),$("#sectedBucketBlock form input:hidden[name=postType]").val(e),"save"===e){var s="INCOMPLETE";$("#sectedBucketBlock #btnGroup #cpSubmit").hasClass("disabled")||(s="SAVED"),$("#sectedBucketBlock form input:hidden[name=status]").val(s)}u=e,o=$("#sectedBucketBlock form").serializeArray(),$.ajax({url:"/compSet/"+u,type:"POST",data:o,success:function(e,t,a){$("#sectedBucketBlock form #cpSave").removeClass("disabled").addClass("disabled");var o=$("#compSetMenu .compSetListItem.active .compSet").text(),s=$("#cpDisplayName").val();if(""!==s.trim()&&(o+=' ("'+s+'")'),"submit"===u){var c="myModal",i="Thank you!",n=o+" has been submitted for review. You will be notified when your Competitive Analysis report is published.<br/><br/>NOTE: Each Competitive Set must be submitted separately",l="",r="OK";fhsAlert(c,i,n,l,r,function(e){e&&window.location.reload(!0)})}else if("approve"===u){c="myModal",i="Approved";var d=$("#sectedBucketBlock form input:hidden[name=compSetId]").val(),p=$("#sectedBucketBlock #btnGroup").attr("data-evalid");n=o+" has been approved.<br/><br/> Dashboard URL :  http://"+document.domain+"/compSetReport/dashboard/"+p+"/?compSetId="+d+"<br/>",l="",r="OK",fhsAlert(c,i,n,l,r,function(e){e&&window.location.reload(!0)})}else c="myModal",i="Competitive Set Saved",n=o+" has been saved successfully.",l="",r="OK",fhsAlert(c,i,n,l,r,function(e){e&&window.location.reload(!0)})},error:function(e,t,a){var o=$("#compSetMenu .compSetListItem.active .compSet").text();fhsAlert("myModal","Error","System couldn't "+u+" "+o+".<br/> Please check list again and try to save again .","","OK",function(e){e?"submit"===u&&$("#sectedBucketBlock form #cpSave").removeClass("disabled"):"approve"===u&&$("#sectedBucketBlock form #cpSubmit").removeClass("disabled")})}})},n=function(){if($("#sectedBucketBlock #btnGroup #cpSubmit").hasClass("disabled"))$("#btnGroup #cpSave").hasClass("disabled")||$("#btnGroup #btnMsg").html('Click "Save" to complete your selections later.');else{var e="Submit";$("#cpSubmit").hasClass("cpApprove")&&(e="Approve"),"true"==o&&"SUBMITTED"==l?$("#btnGroup #btnMsg").html("This Comp Set is ready for review."):"true"==o&&"APPROVED"==l?$("#btnGroup #btnMsg").html("This Comp Set has been published. Any changes will affect clientâ€™s report."):$("#btnGroup #btnMsg").html('When your selections are final, please click "'+e+'".')}},o=$("#btnGroup").attr("data-assigneeView"),l=$("#btnGroup").attr("data-initState");$("#selectedTable").on("click",".selectedPropName",function(){var e=$(this).attr("id").replace("pId","");i($(this).attr("data-rating"));$("#cpAssetTable input[data-ratingId='"+e+"']").prop("checked",!1),$(this).remove(),c(),$("#btnGroup #cpSave").removeClass("disabled")}),$("#selectedTable").on("mouseover",".removeX",function(){$(this).parent().prepend("<span class='tooltip' style='opacity: 1;'>Remove this hotel</span>")}),$("#selectedTable").on("mouseout",".removeX",function(){$(this).parent().find(".tooltip").remove()}),$(document).on("click",".selectCBox",function(){if($(this).parent().find(".ckBx").remove(),$(this).is(":checked")&&s()<1){$(this).attr("checked",!1);return fhsAlert("myModal","Sorry...","You have reached your maximum of 10 hotels. To add this hotel, please delete a property in Your Selections (above).","","CLOSE",function(e){}),!1}var e="";e=$(this).is(":checked")?"<div class='hidden ckBx'>checked</div>":"<div class='hidden ckBx'></div>",$(this).parent().prepend(e),t($(this)),$(this),$("#btnGroup #cpSave").removeClass("disabled");i($(this).attr("data-rating"));c()}),$("#cpDisplayName").bind("keyup",function(){$("#btnGroup #cpSave").removeClass("disabled"),n()}),$("#cpAllowClientView").bind("click",function(){$("#btnGroup #cpSave").removeClass("disabled"),n()}),$(document).on("click","#cDetail",function(e){e.preventDefault();var t=$("#cDetailMsg").html();e.stopImmediatePropagation(),fhsAlert("myModal","Help",t,"","CLOSE",function(e){})}),$(document).on("click","#cpSave",function(e){e.preventDefault(),a("save")}),$(document).on("click","#cpSubmit.cpSubmit",function(e){e.preventDefault();fhsAlert("myModal","Are you sure?","You will not be able to make changes to your Competitive Set  after you submit.","STAY ON THIS PAGE","SUBMIT",function(e){if(!e)return!1;a("submit")})}),$(document).on("click","#cpSubmit.cpApprove",function(e){e.preventDefault();fhsAlert("myModal","Are you sure?",'Note: Comp Set will be approved, but clients are not notified. Clients cannot access the Comp Set unless you click "Grant client access" checkbox on the Selector.<br><br>If you grant client access, C-Supers will see "Competitive" in nav. Please e-mail C-Supers to notify them that the report is available.',"EXIT WITHOUT APPROVING","APPROVE",function(e){if(!e)return!1;a("approve")})}),$(document).on("click","#cpApptove",function(e){e.preventDefault(),a("approve")}),$(window).bind("beforeunload",function(){if(!1===$("#sectedBucketBlock form #cpSave").hasClass("disabled"))return"You have not saved the content you entered on this page."}),$("#cpAssetTable .selectCBox").each(function(){var e="";i($(this).attr("data-rating")),$(this).is(":checked")?(e="<div class='hidden ckBx'>checked</div>",t($(this))):e="<div class='hidden ckBx'></div>",$(this).parent().prepend(e),$(this),c()}),e=$("#compSetMenu .compSetListItem.active .compSet").text().replace("Comp","Competitive"),$("#cpDisplayName").val()===e||""===$("#cpDisplayName").val()?$("#cpNameMsg").show():$("#cpNameMsg").hide(),$("#sectedBucketBlock").scrollToFixed();var r=$("#cpAssetTable").dataTable({sPaginationType:"full_numbers",aoColumnDefs:[{bSortable:!1,aTargets:[0]}],aaSorting:[[1,"asc"]],iDisplayLength:25});$(".chkFilter").on("click",function(){var e="";$("#cpDropboxWrap .chkFilter").each(function(){$(this).prop("checked")&&(e+=$(this).val()+"|")}),""===(e=e.substring(0,e.length-1))&&(e="NOSelection"),r.fnFilter(e,5,!0,!1,!0,!0)}),$(r).bind("draw",function(){var e=$("#selectedTable .selectedPropName").length;$("#cpAssetTable .selectCBox").length;0<e?($("#cpAssetTable .selectCBox:checkbox").removeAttr("checked"),$("#selectedTable .selectedPropName").each(function(){$("#cpAssetTable .selectCBox[data-ratingid="+$(this).attr("data-pid")+"]").attr("checked",!0),$("#cpAssetTable .selectCBox[data-ratingid="+$(this).attr("data-pid")+"]").prop("checked",!0)})):$("#cpAssetTable .selectCBox:checkbox").removeAttr("checked")})}var e;$(document).on("click",".compSetListItem",function(){window.location.href="/compSet/selector/"+$(this).attr("data-cpId")}),$("#helpButton").click(function(e){e.preventDefault();var t=$($(this).attr("data-helpContent")).html();e.stopImmediatePropagation(),fhsAlert("myModal","Help",t,"","CLOSE",function(e){})}),$("#iconBigDownload").click(function(e){e.preventDefault();var t="Excel";""!==$(".excelLinkContent").attr("data-title")&&void 0!==$(".excelLinkContent").attr("data-title")&&(t=$(".excelLinkContent").attr("data-title"));var a=$($(this).attr("data-helpContent")).html();e.stopImmediatePropagation(),fhsAlert("myModal",t,a,"","CLOSE",function(e){})})});